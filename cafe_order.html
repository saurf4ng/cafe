<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´í˜ ì£¼ë¬¸ ì‹œìŠ¤í…œ (ë‚´ì„ : 2058)</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; text-align: center; }
        .menu-item { border: 1px solid #ddd; padding: 10px; margin: 10px; display: flex; align-items: center; justify-content: space-between; }
        .menu-item label { margin-left: 10px; }
        #orders { margin-top: 20px; border-top: 2px solid #000; padding-top: 10px; text-align: left; }
        button { padding: 8px 12px; cursor: pointer; }
        #reset-btn { background-color: red; color: white; }
        #clear-btn { background-color: darkblue; color: white; margin-top: 10px; }
        .option-input { width: 150px; margin-left: 10px; }
        .order-header { display: flex; justify-content: space-between; align-items: center; }
        .category-title { font-size: 1.2em; font-weight: bold; margin-top: 15px; text-align: left; }
    </style>
</head>
<body>

    <h1>ì¹´í˜ ì£¼ë¬¸ ì‹œìŠ¤í…œ</h1>
    <button id="random-order-btn" style="margin-bottom: 15px;" onclick="randomOrder()">ëœë¤ ì£¼ë¬¸</button>


    <h2>ì¹´í…Œê³ ë¦¬ ì„ íƒ</h2>
    <select id="category-select" style="font-size: 1.2em; padding: 10px; width: 250px;" onchange="loadMenu()">
        <option value="">ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
        <option value="ì»¤í”¼">ì»¤í”¼</option>
        <option value="ì£¼ìŠ¤">ì£¼ìŠ¤</option>
        <option value="ì—ì´ë“œ">ì—ì´ë“œ</option>
        <option value="ë¼ë–¼">ë¼ë–¼</option>
        <option value="ì‰ì´í¬">ì‰ì´í¬</option>
        <option value="ìŠ¤ë¬´ë””">ìŠ¤ë¬´ë””</option>
        <option value="ì°¨">ì°¨</option>
        <option value="SPECIAL">SPECIAL</option>
    </select>

    <h2>ë©”ë‰´</h2>
    <div id="menu-list"></div>

    <div id="orders">
        <div class="order-header">
            <h2>ì£¼ë¬¸ ë‚´ì—­</h2>
            <button id="reset-btn" onclick="loadOrders()">ìƒˆë¡œê³ ì¹¨</button>
            <button id="clear-btn" onclick="clearOrders()">ì „ì²´ì‚­ì œ</button>
        </div>
        <ul id="order-list"></ul>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbyGEDXQziC3C06T1ith61N9_G8vYlC1W1hGIOK9nHUdmBg2svL0ngdvyRk_8bossbtpQg/exec";

        const menu = [
            { category: "ì»¤í”¼", name: "ì—ìŠ¤í”„ë ˆì†Œ" },
            { category: "ì»¤í”¼", name: "ì•„ë©”ë¦¬ì¹´ë…¸" },
            { category: "ì»¤í”¼", name: "ì¹´í‘¸ì¹˜ë…¸" },
            { category: "ì»¤í”¼", name: "ì¹´í˜ë¼ë–¼" },
            { category: "ì»¤í”¼", name: "ì¹´ë¼ë©œë¼ë–¼" },
            { category: "ì»¤í”¼", name: "ë°”ë‹ë¼ë¼ë–¼" },
            { category: "ì»¤í”¼", name: "ëª¨ì¹´ë¼ë–¼" },
            { category: "ì»¤í”¼", name: "ì—°ìœ ë¼ë–¼" },
            { category: "ì»¤í”¼", name: "ì†”í‹°í¬ë¦¼ë¼ë–¼" },
            { category: "ì»¤í”¼", name: "ì½œë“œë¸Œë£¨" },
            { category: "ì»¤í”¼", name: "ì½œë“œë¸Œë£¨ë¼ë–¼" },

            { category: "ì£¼ìŠ¤", name: "ë”¸ê¸°ì£¼ìŠ¤" },
            { category: "ì£¼ìŠ¤", name: "í‚¤ìœ„ì£¼ìŠ¤" },
            { category: "ì£¼ìŠ¤", name: "ë°”ë‚˜ë‚˜ì£¼ìŠ¤" },
            { category: "ì£¼ìŠ¤", name: "ë§ê³ ì£¼ìŠ¤" },
            { category: "ì£¼ìŠ¤", name: "í† ë§ˆí† ì£¼ìŠ¤" },
            { category: "ì£¼ìŠ¤", name: "ë”¸ë°”ì£¼ìŠ¤" },
            { category: "ì£¼ìŠ¤", name: "í‚¤ë°”ì£¼ìŠ¤" },
            { category: "ì£¼ìŠ¤", name: "ì°©ì¦™ì£¼ìŠ¤" },

            { category: "ì—ì´ë“œ", name: "ìëª½ì—ì´ë“œ" },
            { category: "ì—ì´ë“œ", name: "ë ˆëª¬ì—ì´ë“œ" },
            { category: "ì—ì´ë“œ", name: "ì˜¤ë Œì§€ì—ì´ë“œ" },
            { category: "ì—ì´ë“œ", name: "ë¸”ë£¨ë² ë¦¬ì—ì´ë“œ" },
            { category: "ì—ì´ë“œ", name: "ì˜¤ëª½ì—ì´ë“œ" },
            { category: "ì—ì´ë“œ", name: "ë³µìˆ­ì•„ì—ì´ë“œ" },

            { category: "ë¼ë–¼", name: "ì´ˆì½”ë¼ë–¼" },
            { category: "ë¼ë–¼", name: "ë§ì°¨ë¼ë–¼" },
            { category: "ë¼ë–¼", name: "í™ì°¨ë¼ë–¼" },
            { category: "ë¼ë–¼", name: "ê³ êµ¬ë§ˆë¼ë–¼" },
            { category: "ë¼ë–¼", name: "ì§„ì €ë¼ë–¼" },
            { category: "ë¼ë–¼", name: "ë¸”ë£¨ë² ë¦¬ë¼ë–¼" },
            { category: "ë¼ë–¼", name: "ì´ˆë‹¹ì˜¥ìˆ˜ìˆ˜ë¼ë–¼" },

            { category: "ì‰ì´í¬", name: "ë°”ë‹ë¼ì‰ì´í¬" },
            { category: "ì‰ì´í¬", name: "ë”¸ê¸°ì‰ì´í¬" },
            { category: "ì‰ì´í¬", name: "ìë°”ì¹©í”„ë¼í˜" },
            { category: "ì‰ì´í¬", name: "í˜¸ë‘ì‰ì´í¬" },
            { category: "ì‰ì´í¬", name: "ì£ ë¦¬íì‰ì´í¬" },

            { category: "ìŠ¤ë¬´ë””", name: "í”Œë ˆì¸ìš”ê±°íŠ¸ìŠ¤ë¬´ë””" },
            { category: "ìŠ¤ë¬´ë””", name: "ë”¸ê¸°ìš”ê±°íŠ¸ìŠ¤ë¬´ë””" },
            { category: "ìŠ¤ë¬´ë””", name: "ë¸”ë£¨ë² ë¦¬ìš”ê±°íŠ¸ìŠ¤ë¬´ë””" },
            { category: "ìŠ¤ë¬´ë””", name: "ë§ê³ ìš”ê±°íŠ¸ìŠ¤ë¬´ë””" },
            { category: "ìŠ¤ë¬´ë””", name: "ì²­í¬ë„ìš”ê±°íŠ¸ìŠ¤ë¬´ë””" },
            { category: "ìŠ¤ë¬´ë””", name: "í™”ì´íŠ¸í”¼ì¹˜ìš”ê±°íŠ¸ìŠ¤ë¬´ë””" },

            { category: "ì°¨", name: "ë ˆëª¬ì°¨" },
            { category: "ì°¨", name: "ìëª½ì°¨" },
            { category: "ì°¨", name: "ì˜¤ë Œì§€ì°¨" },
            { category: "ì°¨", name: "ìœ ìì°¨" },
            { category: "ì°¨", name: "ëŒ€ì¶”ì°¨" },
            { category: "ì°¨", name: "ìƒê°•ì°¨" },
            { category: "ì°¨", name: "ë ˆëª¬ì§„ì €í‹°" },
            { category: "ì°¨", name: "ìºëª¨ë§ˆì¼" },
            { category: "ì°¨", name: "íˆë¹„ìŠ¤ì»¤ìŠ¤" },
            { category: "ì°¨", name: "í˜í¼ë¯¼íŠ¸" },
            { category: "ì°¨", name: "ì–¼ê·¸ë ˆì´" },
            { category: "ì°¨", name: "ì„¤ë…¹ì°¨" },
            { category: "ì°¨", name: "ë³µìˆ­ì•„í‹°" },

            { category: "SPECIAL", name: "ë°”ë°¤ë°” ë§‰ê±¸ë¦¬" },
            { category: "SPECIAL", name: "í•œë¼ë´‰ì°¨" },
            { category: "SPECIAL", name: "í•œë¼ë´‰ì—ì´ë“œ" },
            { category: "SPECIAL", name: "í•œë¼ë´‰ì£¼ìŠ¤" }

        ];

        function loadMenu() {
            const menuList = document.getElementById("menu-list");
            menuList.innerHTML = "";
            const selectedCategory = document.getElementById("category-select").value;

            menu.forEach(item => {
                if (selectedCategory && item.category !== selectedCategory) return;

                const div = document.createElement("div");
                div.className = "menu-item";

                const title = document.createElement("span");
                title.textContent = item.name;
                div.appendChild(title);

                if (item.category === "ì£¼ìŠ¤" || item.category === "ìŠ¤ë¬´ë””" || item.category === "ì—ì´ë“œ" || item.category === "ì‰ì´í¬") {
                    const coldLabel = document.createElement("label");
                    const coldInput = document.createElement("input");
                    coldInput.type = "radio";
                    coldInput.name = `temp-${item.name}`;
                    coldInput.value = "COLD";
                    coldInput.checked = true;
                    coldInput.disabled = true;
                    coldLabel.appendChild(coldInput);
                    coldLabel.appendChild(document.createTextNode(" COLD"));
                    div.appendChild(coldLabel);
                } else {
                    const hotLabel = document.createElement("label");
                    const hotInput = document.createElement("input");
                    hotInput.type = "radio";
                    hotInput.name = `temp-${item.name}`;
                    hotInput.value = "HOT";
                    hotInput.checked = true;
                    hotLabel.appendChild(hotInput);
                    hotLabel.appendChild(document.createTextNode(" HOT"));
                    
                    const coldLabel = document.createElement("label");
                    const coldInput = document.createElement("input");
                    coldInput.type = "radio";
                    coldInput.name = `temp-${item.name}`;
                    coldInput.value = "COLD";
                    coldLabel.appendChild(coldInput);
                    coldLabel.appendChild(document.createTextNode(" COLD"));
                    
                    div.appendChild(hotLabel);
                    div.appendChild(coldLabel);
                }

                const optionInput = document.createElement("input");
                optionInput.type = "text";
                optionInput.placeholder = "ì¶”ê°€ ì˜µì…˜ ì…ë ¥";
                optionInput.className = "option-input";
                optionInput.id = `option-${item.name}`;
                div.appendChild(optionInput);

                const orderButton = document.createElement("button");
                orderButton.textContent = "ì£¼ë¬¸";
                orderButton.onclick = async () => {
                    await placeOrder(item.name);
                    await loadOrders();
                };
                div.appendChild(orderButton);

                menuList.appendChild(div);
            });
        }

        async function placeOrder(menu) {
            const temp = document.querySelector(`input[name="temp-${menu}"]:checked`).value;
            const etc = document.getElementById(`option-${menu}`).value.trim() || "ì—†ìŒ";

            try {
                console.log("ğŸ“¡ Sending request to API:", { menu, temp, etc });

                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "text/plain" }, // âœ… OPTIONS ìš”ì²­ ë°©ì§€ë¥¼ ìœ„í•´ text/plain ì‚¬ìš©
                    body: JSON.stringify({ menu, temp, etc })
                });

                const text = await response.text();
                console.log("ğŸ›°ï¸ Server response:", text);

                const result = JSON.parse(text);
                if (result.status !== "success") {
                    throw new Error(result.message);
                }

                alert("âœ… ì£¼ë¬¸ ì™„ë£Œ!");
                await loadOrders();
            } catch (error) {
                alert("âŒ ì£¼ë¬¸ ì‹¤íŒ¨: " + error);
                console.error("ğŸš¨ ì£¼ë¬¸ ì˜¤ë¥˜:", error);
            }
        }

        async function loadOrders() {
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error("ì„œë²„ ì˜¤ë¥˜");
                const orders = await response.json();
                document.getElementById("order-list").innerHTML = orders.map(o => 
                    `<li>${o.menu} (${o.temp}) - ì˜µì…˜: ${o.etc} x${o.count} 
                    <button onclick="deleteOrder('${o.menu}', '${o.temp}', '${o.etc}')">ì‚­ì œ</button></li>`
                ).join("");
            } catch (error) {
                alert("ì£¼ë¬¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤: " + error);
            }
        }

        async function deleteOrder(menu, temp, etc) {
            if (!confirm(`"${menu} (${temp}) - ${etc}" ì£¼ë¬¸ì„ ì‚­ì œí• ê¹Œìš”?`)) return;

            try {
                const response = await fetch(`${API_URL}?action=delete&menu=${encodeURIComponent(menu)}&temp=${encodeURIComponent(temp)}&etc=${encodeURIComponent(etc)}`);
                const result = await response.json();
                
                if (result.status === "success") {
                    alert("âœ… ì£¼ë¬¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                    loadOrders();
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                alert("âŒ ì‚­ì œ ì‹¤íŒ¨: " + error);
                console.error("ğŸš¨ ì‚­ì œ ì˜¤ë¥˜:", error);
            }
        }

        async function randomOrder() {
            const randomItem = menu[Math.floor(Math.random() * menu.length)]; // ëœë¤ ë©”ë‰´ ì„ íƒ
            const temp = (randomItem.category === "ì£¼ìŠ¤" || randomItem.category === "ìŠ¤ë¬´ë””" || randomItem.category === "ì—ì´ë“œ" || randomItem.category === "ì‰ì´í¬") ? "COLD" : (Math.random() < 0.5 ? "HOT" : "COLD"); // ì˜¨ë„ ì„ íƒ
            const etc = "ëœë¤ ì„ íƒ"; // ê¸°ë³¸ ì˜µì…˜

            try {
                console.log(`ğŸ² ëœë¤ ì£¼ë¬¸: ${randomItem.name} (${temp})`);
                
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: { "Content-Type": "text/plain" }, 
                    body: JSON.stringify({ menu: randomItem.name, temp, etc })
                });

                const text = await response.text();
                console.log("ğŸ›°ï¸ Server response:", text);

                const result = JSON.parse(text);
                if (result.status !== "success") {
                    throw new Error(result.message);
                }

                alert(`âœ… ëœë¤ ì£¼ë¬¸ ì™„ë£Œ: ${randomItem.name} (${temp})`);
                await loadOrders();
            } catch (error) {
                alert("âŒ ëœë¤ ì£¼ë¬¸ ì‹¤íŒ¨: " + error);
                console.error("ğŸš¨ ëœë¤ ì£¼ë¬¸ ì˜¤ë¥˜:", error);
            }
        }


        async function clearOrders() {
            try {
                console.log("ğŸ—‘ Sending clear request to API...");
                const response = await fetch(API_URL + "?action=clear", { method: "GET" });
                const result = await response.json();
                console.log("ğŸ›°ï¸ Server response:", result);
                if (result.status === "success") {
                    alert("âœ… ëª¨ë“  ì£¼ë¬¸ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!");
                    loadOrders();
                } else {
                    throw new Error(result.message);
                }
            } catch (error) {
                alert("âŒ ì£¼ë¬¸ ì‚­ì œ ì‹¤íŒ¨: " + error);
                console.error("ğŸš¨ ì‚­ì œ ì˜¤ë¥˜:", error);
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            // loadMenu();
            loadOrders();
        });
    </script>

</body>
</html>
